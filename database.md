# Database Schema Details

## DDL

### Plant Items Table
```sql
CREATE TABLE PLANT_ITEMS
(
    ID                           NUMBER(19)       NOT NULL,
    CREATED_AT                   TIMESTAMP(6),
    UPDATED_AT                   TIMESTAMP(6),
    PLANT_PARENT_ID              VARCHAR2(255 BYTE),
    PLANT_ID                     VARCHAR2(255 BYTE) NOT NULL,
    FUNCTIONAL_LOCATION          VARCHAR2(255 BYTE),
    PARENT_FUNCTIONAL_LOCATION   VARCHAR2(255 BYTE),
    ASSET_MANAGEMENT_ID          VARCHAR2(100 BYTE),
    DESCRIPTION                  VARCHAR2(500 BYTE) NOT NULL,
    LOCATION                     VARCHAR2(100 BYTE),
    CODE                         VARCHAR2(500 BYTE),
    PLANT_GROUP                  VARCHAR2(255 BYTE) NOT NULL,
    PLANT_TYPE                   VARCHAR2(255 BYTE),
    DEFAULT_RESTORE_CONDITION    VARCHAR2(200 BYTE),
    DEFAULT_ISOLATION_CONDITION  VARCHAR2(200 BYTE),
    IS_PLANT_ITEM                CHAR(1 BYTE),
    IS_ISOLATION_POINT           CHAR(1 BYTE),
    IS_CONFINED_SPACE            CHAR(1 BYTE),
    IS_SAFETY_SYSTEM             CHAR(1 BYTE),
    BARCODE_ID                   VARCHAR2(50 BYTE),
    EQUIPMENT_NUM                VARCHAR2(100 BYTE),
    IS_TEMPORARY_ITEM            CHAR(1 BYTE),
    PLANT_IDENTIFIER             VARCHAR2(100 BYTE),
    ISOLATION_POINT_NUM          VARCHAR2(100 BYTE),
    SWITCHBOARD_CUBICLE_NUMBER   VARCHAR2(255 BYTE),
    CIRCUIT_VOLTAGE              VARCHAR2(50 BYTE),
    IS_CRITICAL_PLANT            CHAR(1 BYTE),
    DRAWING_REFERENCE            VARCHAR2(100 BYTE),
    IS_LIMITED_AUTHORITY         CHAR(1 BYTE),
    METHOD_OF_PROVING            VARCHAR2(255 BYTE),
    IS_PASSING_VALVE             CHAR(1 BYTE),
    DATA_SOURCE                  VARCHAR2(255 BYTE) NOT NULL,
    DATA_SOURCE_ID               VARCHAR2(255 BYTE),
    INTEGRATED_AT                TIMESTAMP(6)
);


CREATE UNIQUE INDEX PLANT_ID_UNIQUE ON PLANT_ITEMS (PLANT_ID);

CREATE UNIQUE INDEX PLANT_ITEMS_ID_PK ON PLANT_ITEMS;

CREATE UNIQUE INDEX PLANT_ITEMS_PLANT_ID_UK ON PLANT_ITEMS (LOWER("PLANT_ID"));

CREATE INDEX PLAN_ITEM_PLAN_PAREN_ID_INDE ON PLANT_ITEMS (PLANT_PARENT_ID);

CREATE OR REPLACE TRIGGER plant_items_id_trg
            before insert on PLANT_ITEMS
            for each row
begin
            if :new.ID is null then
select plant_items_id_seq.nextval into :new.ID from dual;
end if;
end;
/


CREATE OR REPLACE SYNONYM ATLIS7_OWNER.PLANT_ITEMS FOR PLANT_ITEMS;
CREATE OR REPLACE SYNONYM MIS_MAXIMO.PLANT_ITEMS FOR PLANT_ITEMS;


ALTER TABLE PLANT_ITEMS ADD (
  CONSTRAINT CHK_CIRCUIT_VOLTAGE
  CHECK (circuit_voltage in ('120V', '208V', '277V','480V','4.16kV','13kV'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_CONFINED_SPACE
  CHECK (is_confined_space in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_CRITICAL_PLANT
  CHECK (is_critical_plant in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_ISOLATION_POINT
  CHECK (is_isolation_point in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_LIMITED_AUTHORITY
  CHECK (is_limited_authority in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_PASSING_VALVE
  CHECK (is_passing_valve in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_PLANT_ITEM
  CHECK (is_plant_item in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_SAFETY_SYSTEM
  CHECK (is_safety_system in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_IS_TEMPORARY_ITEM
  CHECK (is_temporary_item in ('0','1'))
  ENABLE VALIDATE,
  CONSTRAINT CHK_METHOD_OF_PROVING
  CHECK (method_of_proving in ('ZEV', 'ZVV', 'VVU'))
  ENABLE VALIDATE,
  CONSTRAINT PLANT_ITEMS_ID_PK
  PRIMARY KEY
  (ID)
  USING INDEX PLANT_ITEMS_ID_PK
  ENABLE VALIDATE,
  CONSTRAINT PLANT_ID_UNIQUE
  UNIQUE (PLANT_ID)
  USING INDEX PLANT_ID_UNIQUE
  ENABLE VALIDATE);

ALTER TABLE PLANT_ITEMS ADD (
  FOREIGN KEY (PLANT_PARENT_ID)
  REFERENCES PLANT_ITEMS (PLANT_ID)
  ENABLE VALIDATE);

GRANT DELETE, INSERT, SELECT, UPDATE ON PLANT_ITEMS TO ATLIS7_OWNER;
GRANT DELETE, INSERT, SELECT, UPDATE ON PLANT_ITEMS TO HCO_OWNER;
GRANT DELETE, INSERT, SELECT, UPDATE ON PLANT_ITEMS TO MIS_MAXIMO;

```


### Isolation Points Table

```sql
CREATE TABLE ISOLATION_POINTS
(
    ID                       NUMBER(19)           NOT NULL,
    PLANT_ITEM_ID            NUMBER(10)           NOT NULL,
    ISOLATION_PLANT_ITEM_ID  NUMBER(10)           NOT NULL
);


CREATE UNIQUE INDEX ISOLATION_POINTS_ID_PK ON ISOLATION_POINTS;

CREATE OR REPLACE TRIGGER isolation_points_id_trg
            before insert on ISOLATION_POINTS
            for each row
begin
            if :new.ID is null then
select isolation_points_id_seq.nextval into :new.ID from dual;
end if;
end;
/

ALTER TABLE ISOLATION_POINTS ADD (
  CONSTRAINT ISOLATION_POINTS_ID_PK
  PRIMARY KEY (ID)
  USING INDEX ISOLATION_POINTS_ID_PK
  ENABLE VALIDATE);

ALTER TABLE ISOLATION_POINTS ADD (
  CONSTRAINT ISOLATIO_POINT_PLAN_ITE_ID_FK
  FOREIGN KEY (PLANT_ITEM_ID)
  REFERENCES PLANT_ITEMS (ID)
  ON DELETE CASCADE
  ENABLE VALIDATE,
  CONSTRAINT ISOLAT_POI_ISOLAT_PL_IT_ID_FK
  FOREIGN KEY (ISOLATION_PLANT_ITEM_ID)
  REFERENCES PLANT_ITEMS (ID)
  ENABLE VALIDATE);

GRANT DELETE, INSERT, SELECT, UPDATE ON ISOLATION_POINTS TO ATLIS7_OWNER;
GRANT DELETE, INSERT, SELECT, UPDATE ON ISOLATION_POINTS TO MIS_MAXIMO;
GRANT DELETE, INSERT, SELECT, UPDATE ON ISOLATION_POINTS TO HCO_OWNER;

```
